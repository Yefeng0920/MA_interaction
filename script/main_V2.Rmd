---
title: "Statistical issues in multiple stressor effects and their interaction"
output: html_document
date: '2024-04-29'
---

# Set-up

```{r, warning=FALSE, echo=TRUE}
set.seed(2024)
suppressPackageStartupMessages({
  library(dplyr)
  library(readr)
  library(tidyr) 
  library(purrr)
  library(ggplot2)
  library(ggpubr)
  library(here)
  library(clubSandwich)  
  library(metafor)
  library(cowplot)
  library(patchwork)
  #library(orchaRd)
  })

source(here("function","ES calc.R"))
source(here("function","Error calc.R"))
source(here("function","Fig.R"))
source(here("function","Hetero calc.R"))
```

# Original analysis by the author

## Data

```{r}
dt=read.csv(here("dat", 'OAW_interaction.csv'))
```

## Model selection

```{r}
##### 1.Generating variance-covariance matrices-------------------------------------------------
V_0.5 <- make_VCV_matrix(data = dt, V = "variance",cluster = "share_organism", 
                         obs = "Effect_size_ID", type = "vcv", rho = 0.5) 
V_0.9 <- make_VCV_matrix(data = dt, V = "variance",cluster = "share_organism", 
                         obs = "Effect_size_ID", type = "vcv", rho = 0.9)  # for sensitivity analysis

matrixcalc::is.positive.definite(V_0.5) # TRUE
matrixcalc::is.positive.definite(V_0.9) # TRUE

##### 2.Defining random effects structure----
# Effect_size_ID to estimate the residual heterogeneity,and StudyID to account for dependence between effect
# size from the same publication were always included.

## for whole dataset
RE1.dt <- rma.mv(yi = Main_effect, V = variance, 
                 random = list(~1 | StudyID, ~1 | Effect_size_ID,~1 | Species,~1 | Shared_first_author,
                               ~1 | Country), data = dt, method = "ML")
RE2.dt <- rma.mv(yi = Main_effect, V = variance, 
                 random = list(~1 | StudyID, ~1 | Effect_size_ID,~1 | Species,~1 | Shared_first_author), 
                 data = dt, method = "ML")
RE3.dt <- rma.mv(yi = Main_effect, V = variance, 
                 random = list(~1 | StudyID, ~1 | Effect_size_ID,~1 | Species,~1 | Country), 
                 data = dt, method = "ML")
RE4.dt <- rma.mv(yi = Main_effect, V = variance, 
                 random = list(~1 | StudyID, ~1 | Effect_size_ID,~1 | Shared_first_author,~1 | Country), 
                 data = dt, method = "ML")

RE5.dt <- rma.mv(yi = Main_effect, V = variance, 
                 random = list(~1 | StudyID, ~1 | Effect_size_ID,~1 | Shared_first_author), 
                 data = dt, method = "ML")
RE6.dt <- rma.mv(yi = Main_effect, V = variance, 
                 random = list(~1 | StudyID, ~1 | Effect_size_ID,~1 | Country), 
                 data = dt, method = "ML")
RE7.dt <- rma.mv(yi = Main_effect, V = variance, 
                 random = list(~1 | StudyID, ~1 | Effect_size_ID,~1 | Species), 
                 data = dt, method = "ML")
RE8.dt <- rma.mv(yi = Main_effect, V = variance, random = list(~1 | StudyID, ~1 | Effect_size_ID), 
                 data = dt, method = "ML")
AIC(RE1.dt,RE2.dt,RE3.dt,RE4.dt,RE5.dt,RE6.dt,RE7.dt,RE8.dt)
```

## Results corresponding to Fig 2

```{r}
##### FIG 2 overall OA,OW,and interaction effects on marine trophic levels----
# Predator unmerged using the moderator "TrophicLevel"
V_0.5 <- make_VCV_matrix(data = dt, V = "variance",cluster = "share_organism", 
                         obs = "Effect_size_ID", type = "vcv", rho = 0.5)

str_TL <- rma.mv(yi = Main_effect, V = V_0.5, mods = ~Stressor*TrophicLevel-1,random = list(~1 | StudyID, ~1 | Effect_size_ID, ~ 1 | Species), 
              data = dt, method = "REML")

# Predator merged using the moderator "Trophic_level"
str_tl=rma.mv(yi = Main_effect, V = V_0.5, mods = ~Stressor*Trophic_level-1,
              random = list(~1 | StudyID, ~1 | Effect_size_ID), 
              data = dt, method = "REML")


# I guess 
mod_results(str_TL, mod = "Stressor", group = "StudyID", data = dt)
orchard_plot(str_TL, mod = "Stressor", group = "StudyID",
             trunk.size = 0.1, xlab = "Effect size (lnRR)")



orchard_plot(str_TL, mod = "TrophicLevel", group = "StudyID",
             trunk.size = 0.1, xlab = "Effect size (lnRR)")

##

dt$Stressor_TrophicLevel <- paste(dt$Stressor, dt$TrophicLevel, sep = "\n")

str_tl2=rma.mv(yi = Main_effect, V = V_0.5, mods = ~Stressor_TrophicLevel,random = list(~1 | StudyID, ~1 | Effect_size_ID), data = dt, method = "REML")

p_str_tl2 <- orchard_plot(str_tl2, mod = "Stressor_TrophicLevel", group = "StudyID",
             trunk.size = 0.1, xlab = "Effect size (lnRR)", angle = 45)

p_str_tl2
```

## Results corresponding to Fig 3

```{r}
##### FIG 3A Effects on calcifiers at different trophic levels----
## calcifiers
# unmerged predators

# I realise that if people use subset argument in metafor - orchard does not run 
# I need to fix it 

dat1 <- subset(dt, Calcifier=='y')

calstr_TL=rma.mv(yi = Main_effect, V = V_0.5, mods = ~Stressor*TrophicLevel-1,
                 random = list(~1 | StudyID, ~1 | Effect_size_ID), 
                 data = dt, method = "REML")
summary(calstr_TL)

# note calstr_TL & calstr_TL are the same 
V_0.5b <- make_VCV_matrix(data = dat1, V = "variance",cluster = "share_organism", 
                         obs = "Effect_size_ID", type = "vcv", rho = 0.5)

calstr_TL2 =rma.mv(yi = Main_effect, V = V_0.5b, mods = ~Stressor_TrophicLevel-1,
                 random = list(~1 | StudyID, ~1 | Effect_size_ID), 
                 data = dat1, method = "REML")

summary(calstr_TL2)

p_calstr_TL2 <- orchard_plot(calstr_TL2, mod = "Stressor_TrophicLevel", 
                             group = "StudyID", trunk.size = 0.1, 
                             xlab = "Effect size (lnRR)", angle = 45)

p_calstr_TL2

# Merged
calstr_tl=rma.mv(yi = Main_effect, V = V_0.5b, mods = ~Stressor_TrophicLevel-1,
                 #subset=(Calcifier=='y'),
                 random = list(~1 | StudyID, ~1 | Effect_size_ID), 
                 data = dat1, method = "REML")

p_calstr_tl <- orchard_plot(calstr_tl, mod = "Stressor_TrophicLevel", 
                             group = "StudyID", trunk.size = 0.1, 
                             xlab = "Effect size (lnRR)", angle = 45)

p_calstr_tl
##### FIG 3B Effects on non-calcifiers at different trophic levels----
## non-calcifiers
# Unmerged
ncalstr_TL=rma.mv(yi = Main_effect, V = V_0.5b, mods = ~Stressor_TrophicLevel-1,
                  #subset=(Calcifier=='n'),
                  random = list(~1 | StudyID, ~1 | Effect_size_ID), 
                  data = dat1, method = "REML")

p_ncalstr_TL <- orchard_plot(ncalstr_TL, mod = "Stressor_TrophicLevel", 
                             group = "StudyID", trunk.size = 0.1, 
                             xlab = "Effect size (lnRR)", angle = 45)

p_ncalstr_TL

# Merged
ncalstr_tl=rma.mv(yi = Main_effect, V = V_0.5b, mods = ~Stressor_TrophicLevel-1,
                  #subset=(Calcifier=='n'),
                  random = list(~1 | StudyID, ~1 | Effect_size_ID), 
                  data = dat1, method = "REML")

p_ncalstr_tl <- orchard_plot(ncalstr_tl, mod = "Stressor_TrophicLevel", 
                             group = "StudyID", trunk.size = 0.1, 
                             xlab = "Effect size (lnRR)", angle = 45)

p_ncalstr_tl

noncalstre <- rma.mv(yi = Main_effect, V = V_0.5b, mods = ~Stressor-1,
                     #subset=(Calcifier=='n'),
                     random = list(~1 | StudyID, ~1 | Effect_size_ID), 
                     data = dat1, method = "REML")

p_noncalstre <- orchard_plot(noncalstre, mod = "Stressor", 
                             group = "StudyID", trunk.size = 0.1, 
                              trunk.size = 0.3, branch.size = 2,
                            xlab = "Effect size (lnRR)", flip = FALSE)

p_noncalstre

```

## Results corresponding to Fig 5

```{r}
##### FIG 5 Effects on climate regions----
tropic <- filter(dt, Region2=='Tropical')
V_0.5_tropic <- make_VCV_matrix(data = tropic, V = "variance",cluster = "share_organism",
                                obs = "Effect_size_ID", type = "vcv", rho = 0.5) 
tropic_model <- rma.mv(yi = Main_effect, V = V_0.5_tropic, mods = ~Stressor-1,random = list(~1 | StudyID, ~1 | Effect_size_ID), 
                       data = tropic, method = "REML")

p_tropic <- orchard_plot(tropic_model, mod = "Stressor", group = "StudyID",
                          trunk.size = 0.3, branch.size = 2,
                            xlab = "Effect size (lnRR)", flip = FALSE)

p_tropic

sub_tropic <- filter(dt, Region2=='Sub-tropical')
V_0.5_sub_tropical <- make_VCV_matrix(data = sub_tropic, V = "variance",cluster = "share_organism", 
                                      obs = "Effect_size_ID", type = "vcv", rho = 0.5) 
sub_t_model <- rma.mv(yi = Main_effect, V = V_0.5_sub_tropical, mods = ~Stressor-1,random = list(~1 | StudyID, ~1 | Effect_size_ID), 
                      data = sub_tropic, method = "REML")

p_sub_t <- orchard_plot(sub_t_model, mod = "Stressor", group = "StudyID",
                        trunk.size = 0.3, branch.size = 2,
                            xlab = "Effect size (lnRR)", flip = FALSE)

p_sub_t

temperate <- filter(dt, Region2=='Temperate')

V_0.5_temperate <- make_VCV_matrix(data = temperate, V = "variance",cluster = "share_organism", 
                                   obs = "Effect_size_ID", type = "vcv", rho = 0.5) 
temperate_model <- rma.mv(yi = Main_effect, V = V_0.5_temperate, mods = ~Stressor-1,random = list(~1 | StudyID, ~1 | Effect_size_ID), 
                          data = temperate, method = "REML")

p_temperate <- orchard_plot(temperate_model, mod = "Stressor", group = "StudyID",
                            trunk.size = 0.3, branch.size = 2,
                            xlab = "Effect size (lnRR)", flip = FALSE)

p_temperate

```

# Re-analysis

## Data

```{r}
dt <- read.csv(here("dat", 'OAW_interaction.csv'))

# only select variables that are relevant to the meta-analytic modelling
dt2 <- select(dt, StudyID, Year, Latitude, Longitude, Abs_lat, Region, Region2, Duration, Species, Stressor, Calcifier, BiologicalResponses, TrophicLevel, Trophic_level, LifeStage, share_organism, Nc, Ne, Xc, Xe, Sc, Se)
#dt2 <- dt[,1:35]
#which(colnames(dt2)%in%(c("Effect_size_ID", "Factor")))
#dt2 <- dt2[, -c(6,16)]
# convert it into a wide format so that we can calculate different types of effect sizes
dt_wide <- pivot_wider(dt2, names_from = Stressor,
                       values_from = c(Ne, Xe, Se),
                       names_sep ="_")
# add ob ID
dt_wide$Effect_size_ID <- 1:nrow(dt_wide)
```

## Effect size computation

```{r}
# 'Focal' effect_size 
effect_size <- with(dt_wide, mapply(effect_set, 
                      CC_n = Nc,
                      CC_mean = Xc, 
                      CC_SD = Sc,
                      EC_n = Ne_OA, 
                      EC_mean = Xe_OA, 
                      EC_SD = Se_OA,
                      CS_n = Ne_OW, 
                      CS_mean = Xe_OW, 
                      CS_SD = Se_OW,
                      ES_n = Ne_interaction, 
                      ES_mean = Xe_interaction, 
                      ES_SD = Se_interaction,
                      percent = "no",
                      SIMPLIFY = FALSE
                      ))
effect_size <- map_dfr(effect_size, I)

# 'Pairwise' effect size
effect_size2 <- with(dt_wide, mapply(effect_set2, 
                      CC_n = Nc,
                      CC_mean = Xc, 
                      CC_SD = Sc,
                      EC_n = Ne_OA, 
                      EC_mean = Xe_OA, 
                      EC_SD = Se_OA,
                      CS_n = Ne_OW, 
                      CS_mean = Xe_OW, 
                      CS_SD = Se_OW,
                      ES_n = Ne_interaction, 
                      ES_mean = Xe_interaction, 
                      ES_SD = Se_interaction,
                      percent = "no",
                      SIMPLIFY = FALSE))

effect_size2 <- map_dfr(effect_size2, I)


# remove NA
full_info <- which(complete.cases(effect_size) == TRUE)
dat <- bind_cols(dt_wide, effect_size, effect_size2)
dat <- dat[full_info, ]

# remove Inf and -Inf
dat <- dat[!is.infinite(dat$lnRR_E) & !is.infinite(dat$lnRRV_E) &
             !is.infinite(dat$lnRR_S) & !is.infinite(dat$lnRRV_S) &
             !is.infinite(dat$lnRR_ES) & !is.infinite(dat$lnRRV_ES) &
             !is.infinite(dat$SMD_E) & !is.infinite(dat$SMDV_E) &
             !is.infinite(dat$SMD_S) & !is.infinite(dat$SMDV_S) &
             !is.infinite(dat$SMD_ES) & !is.infinite(dat$SMDV_ES), ]
```

## Statistical issue 1

The original authors mixed up effect sizes for different main effects and the interaction, and used a meta-regression to estimate the mean effects of different main effects and the interaction. This is both statistically and biologically wrong.

### Meta-regression allowing heteroscedasticity

A meta-regression model used by the original authors assumes homoscedasticity, which means the variances of the two main effects and interaction are assumed to be the same. However, the empirical distribution of the effect sizes of the two main effects and interaction, as shown in Figure 2, clearly shows that two main effects and interaction have unequal variances. A tentative approach is to use multivariate meta-analysis model.

However, the results based on multivariate approach indicate that there were no main effects and interaction

```{r}
# multivariate approach allowing heterogeneity to differ across different levels of a predictor
V_0.5 <- metafor::vcalc(vi = variance, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = dt)

str_TL_mv0.52 <- rma.mv(yi = Main_effect, 
                   V = V_0.5, 
                   mods = ~Stressor - 1, 
                   random = list(~ Stressor | StudyID), 
                   struct = "HCS",
                   data = dt, method = "ML")

str_TL_mv0.51 <- rma.mv(yi = Main_effect, 
                   V = V_0.5, 
                   mods = ~Stressor - 1, 
                   random = list(~ Stressor | StudyID), 
                   struct = "DIAG",
                   data = dt, method = "ML")

# use LRT to test whether variance components significantly differ across different levels of stressor
str_TL_mv0.50 <- update(str_TL_mv0.51, struct="ID")
anova(str_TL_mv0.50, str_TL_mv0.52)

p_str_TL_mv0.5 <- orchard_plot(str_TL_mv0.5, mod = "Stressor", group = "StudyID",
                               trunk.size = 0.3, branch.size = 2,
                            xlab = "Effect size (lnRR)", flip = FALSE)

p_str_TL_mv0.5

# given multivariate approach is sensitive to the assumed sampling correlation, we assume different values of sampling correlation to check the robustness of the model results
## a higher correlation
V_0.9 <- metafor::vcalc(vi = variance, cluster = share_organism, obs = Effect_size_ID, rho = 0.9, data = dt)


str_TL_mv0.9 <- rma.mv(yi = Main_effect, 
                   V = V_0.9, 
                   mods = ~Stressor - 1, 
                   random = list(~ Stressor | StudyID), 
                   struct = "DIAG",
                   data = dt, method = "REML")

p_str_TL_mv0.9 <- orchard_plot(str_TL_mv0.9, mod = "Stressor", group = "StudyID",
                               trunk.size = 0.3, branch.size = 2,
                            xlab = "Effect size (lnRR)", flip = FALSE)

p_str_TL_mv0.9

## a lower correlation
V_0.2 <- metafor::vcalc(vi = variance, cluster = share_organism, obs = Effect_size_ID, rho = 0.2, data = dt)

str_TL_mv0.2 <- rma.mv(yi = Main_effect, 
                   V = V_0.2, 
                   mods = ~Stressor - 1, 
                   random = list(~ Stressor | StudyID), 
                   struct = "DIAG",
                   data = dt, method = "REML")

summary(str_TL_mv0.2)
str_TL_mv0.2r <-  robust(str_TL_mv0.2, cluster = dt$StudyID)
summary(str_TL_mv0.2r)

p_str_TL_mv0.2 <- orchard_plot(str_TL_mv0.2, mod = "Stressor", group = "StudyID",
                               trunk.size = 0.3, branch.size = 2,
                            xlab = "Effect size (lnRR)", flip = FALSE)

p_str_TL_mv0.2


```

### Separate analysis of two main effects and their interaction

Biologically, two main effects and their interaction represent three different biological processes of marine ecosystem's response to stressors, they cannot be jointly synthesized. The average effects across two main effects and their interaction is meaningless and joint synthesis of them creates artifact heterogeneity. A approach is to separately analyse each of the two main effects and their interaction.

However, results based on this proper approach indicate discrepant results.

```{r}
# main effect 1 - OA
## lnRR
## VCV
V_0.5_E <- metafor::vcalc(vi = lnRRV_E, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = dat)
## estimates of main effect1
str_TL_E <- rma.mv(yi = lnRR_E, V = V_0.5_E, random = list(~1 | StudyID, ~1 | Effect_size_ID), 
                   data = dat, method = "REML")

## estimates of different TrophicLevel - fig 2
dat$TrophicLevel <- as.factor(dat$TrophicLevel)
dat$TrophicLevel <- factor(dat$TrophicLevel, levels = c("top-predator", "meso-predator", "herbivore","primary producer"))
str_TL_E_fig2 <- rma.mv(yi = lnRR_E, V = V_0.5_E, mods = ~ TrophicLevel - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = dat, method = "REML")

## estimates of different Calcifier - fig 3
## y
V_0.5_E_y <- metafor::vcalc(vi = lnRRV_E, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = filter(dat,Calcifier=="y"))

str_TL_E_fig3a1 <- rma.mv(yi = lnRR_E, V = V_0.5_E_y, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="y"), method = "REML")
str_TL_E_fig3a2 <- rma.mv(yi = lnRR_E, V = V_0.5_E_y, mods = ~ TrophicLevel - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="y"), method = "REML")


## n
V_0.5_E_n <- metafor::vcalc(vi = lnRRV_E, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = filter(dat,Calcifier=="n"))

str_TL_E_fig3a3 <- rma.mv(yi = lnRR_E, V = V_0.5_E_n, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="n"), method = "REML")

str_TL_E_fig3a4 <- rma.mv(yi = lnRR_E, V = V_0.5_E_n, mods = ~ TrophicLevel - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="n"), method = "REML")


## estimates of different Region2 - fig 5
dat$Region2 <- as.factor(dat$Region2)
dat$Region2 <- factor(dat$Region2, levels = c("Temperate", "Sub-tropical", "Tropical"))
str_TL_E_fig5 <- rma.mv(yi = lnRR_E, V = V_0.5_E, mods = ~ Region2 - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = dat, method = "REML")

# main effect 2 - OW
# lnRR
## VCV
V_0.5_S <- metafor::vcalc(vi = lnRRV_S, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = dat)
## estimates of main effect2
str_TL_S <- rma.mv(yi = lnRR_S, V = V_0.5_S, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = dat, method = "REML")

## estimates of different TrophicLevel - fig 2
str_TL_S_fig2 <- rma.mv(yi = lnRR_S, V = V_0.5_S, mods = ~ TrophicLevel - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = dat, method = "REML")



## estimates of different Calcifier - fig 3
## y
V_0.5_S_y <- metafor::vcalc(vi = lnRRV_S, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = filter(dat,Calcifier=="y"))

str_TL_S_fig3a1 <- rma.mv(yi = lnRR_S, V = V_0.5_S_y, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="y"), method = "REML")
str_TL_S_fig3a2 <- rma.mv(yi = lnRR_S, V = V_0.5_S_y, mods = ~ TrophicLevel - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="y"), method = "REML")


## n
V_0.5_S_n <- metafor::vcalc(vi = lnRRV_S, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = filter(dat,Calcifier=="n"))

str_TL_S_fig3a3 <- rma.mv(yi = lnRR_S, V = V_0.5_S_n, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="n"), method = "REML")
str_TL_S_fig3a4 <- rma.mv(yi = lnRR_S, V = V_0.5_S_n, mods = ~ TrophicLevel - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="n"), method = "REML")


## estimates of different Region2 - fig 5
str_TL_S_fig5 <- rma.mv(yi = lnRR_S, V = V_0.5_S, mods = ~ Region2 - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = dat, method = "REML")

# interaction
# lnRR
# VCV
V_0.5_ES <- metafor::vcalc(vi = lnRRV_ES, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = dat)
## estimates of interaction
str_TL_ES <- rma.mv(yi = lnRR_ES, V = V_0.5_ES, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = dat, method = "REML")

## estimates of different TrophicLevel - fig 2
str_TL_ES_fig2 <- rma.mv(yi = lnRR_ES, V = V_0.5_ES, mods = ~ TrophicLevel - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = dat, method = "REML")


## estimates of different Calcifier - fig 3
str_TL_ES_fig.3 <- rma.mv(yi = lnRR_ES, V = V_0.5_ES, mods = ~ Calcifier - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = dat, method = "REML")

## y
V_0.5_ES_y <- metafor::vcalc(vi = lnRRV_ES, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = filter(dat,Calcifier=="y"))

str_TL_ES_fig3a1 <- rma.mv(yi = lnRR_ES, V = V_0.5_ES_y, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="y"), method = "REML")
str_TL_ES_fig3a2 <- rma.mv(yi = lnRR_ES, V = V_0.5_ES_y, mods = ~ TrophicLevel - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="y"), method = "REML")

## n
V_0.5_ES_n <- metafor::vcalc(vi = lnRRV_ES, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = filter(dat,Calcifier=="n"))

str_TL_ES_fig3a3 <- rma.mv(yi = lnRR_ES, V = V_0.5_ES_n, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="n"), method = "REML")
str_TL_ES_fig3a4 <- rma.mv(yi = lnRR_ES, V = V_0.5_ES_n, mods = ~ TrophicLevel - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="n"), method = "REML")


## estimates of different Region2 - fig 5
str_TL_ES_fig5 <- rma.mv(yi = lnRR_ES, V = V_0.5_ES, mods = ~ Region2 - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = dat, method = "REML")
```

## Statistical issue 2

The mean effects produced from a meta-analysis cannot be properly interpreted without an analysis of heterogeneity, or inconsistency, among effect sizes. The original author did not report heterogeneity statistics. Average effect sizes with high heterogeneity have questionable meaning. While meta-analysis of a set of similar experiments on a single species has a clear interpretation, interpreting a meta-effect across species and biogeographic contexts may be questionable. While average effects are often assumed to yield generalities, averages of highly heterogeneous effect sizes are neither generalizable nor transferable by themselves.

```{r}
# I2
i2_ml(str_TL_E)
i2_ml(str_TL_S)
i2_ml(str_TL_ES)
# CV
cv_ml(str_TL_E)
cv_ml(str_TL_S)
cv_ml(str_TL_ES)

# PI
mod_results(str_TL_E, group = "StudyID", data = dat)
mod_results(str_TL_S, group = "StudyID", data = dat)
mod_results(str_TL_ES, group = "StudyID", data = dat)
```

## Statistical issue 3

The main effects and their interaction depends on the scale of the effect. The original author used measured the main effects and their interaction at the multiplicative scale (lnRR). However, using additive scale (SMD) to measure the main effects and their interaction leads to different conclusions.

```{r}
# main effect 1 - OA
## SMD
## VCV
V_0.5_E <- metafor::vcalc(vi = SMDV_E, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = dat)
## estimates of main effect1
str_TL_E2 <- rma.mv(yi = SMD_E, V = V_0.5_E, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = dat, method = "REML")

## estimates of different TrophicLevel - fig 2
dat$TrophicLevel <- as.factor(dat$TrophicLevel)
dat$TrophicLevel <- factor(dat$TrophicLevel, levels = c("top-predator", "meso-predator", "herbivore","primary producer"))
str_TL_E2_fig2 <- rma.mv(yi = SMD_E, V = V_0.5_E, mods = ~ TrophicLevel - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = dat, method = "REML")


## estimates of different Calcifier - fig 3
## y
V_0.5_E_y <- metafor::vcalc(vi = SMDV_E, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = filter(dat,Calcifier=="y"))

str_TL_E2_fig3a1 <- rma.mv(yi = SMD_E, V = V_0.5_E_y, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="y"), method = "REML")
str_TL_E2_fig3a2 <- rma.mv(yi = SMD_E, V = V_0.5_E_y, mods = ~ TrophicLevel - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="y"), method = "REML")


## n
V_0.5_E_n <- metafor::vcalc(vi = SMDV_E, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = filter(dat,Calcifier=="n"))

str_TL_E2_fig3a3 <- rma.mv(yi = SMD_E, V = V_0.5_E_n, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="n"), method = "REML")

str_TL_E2_fig3a4 <- rma.mv(yi = SMD_E, V = V_0.5_E_n, mods = ~ TrophicLevel - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="n"), method = "REML")


## estimates of different Region2 - fig 5
dat$Region2 <- as.factor(dat$Region2)
dat$Region2 <- factor(dat$Region2, levels = c("Temperate", "Sub-tropical", "Tropical"))
str_TL_E2_fig5 <- rma.mv(yi = SMD_E, V = V_0.5_E, mods = ~ Region2 - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = dat, method = "REML")


# main effect 2 - OW
# SMD
## VCV
V_0.5_S <- metafor::vcalc(vi = SMDV_S, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = dat)
## estimates of main effect2
str_TL_S2 <- rma.mv(yi = SMD_S, V = V_0.5_S, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = dat, method = "REML")

## estimates of different TrophicLevel - fig 2
str_TL_S2_fig2 <- rma.mv(yi = SMD_S, V = V_0.5_S, mods = ~ TrophicLevel - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = dat, method = "REML")


## estimates of different Calcifier - fig 3
str_TL_S2_fig3 <- rma.mv(yi = SMD_S, V = V_0.5_S, mods = ~ Calcifier - 1, 
                    random = list(~1 | StudyID, ~1 | Effect_size_ID), data = dat, method = "REML")

## y
V_0.5_S_y <- metafor::vcalc(vi = SMDV_S, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = filter(dat,Calcifier=="y"))

str_TL_S2_fig3a1 <- rma.mv(yi = SMD_S, V = V_0.5_S_y, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="y"), method = "REML")
str_TL_S2_fig3a2 <- rma.mv(yi = SMD_S, V = V_0.5_S_y, mods = ~ TrophicLevel - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="y"), method = "REML")

## n
V_0.5_S_n <- metafor::vcalc(vi = SMDV_S, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = filter(dat,Calcifier=="n"))

str_TL_S2_fig3a3 <- rma.mv(yi = SMD_S, V = V_0.5_S_n, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="n"), method = "REML")
str_TL_S2_fig3a4 <- rma.mv(yi = SMD_S, V = V_0.5_S_n, mods = ~ TrophicLevel - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="n"), method = "REML")




## estimates of different Region2 - fig 5
str_TL_S2_fig5 <- rma.mv(yi = SMD_S, V = V_0.5_S, mods = ~ Region2 - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = dat, method = "REML")


# interaction
# SMD
# VCV
V_0.5_ES <- metafor::vcalc(vi = SMDV_ES, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = dat)
## estimates of interaction
str_TL_ES2 <- rma.mv(yi = SMD_ES, V = V_0.5_ES, 
                     random = list(~1 | StudyID, ~1 | Effect_size_ID), data = dat, method = "REML")

## estimates of different TrophicLevel - fig 2
str_TL_ES2_fig2 <- rma.mv(yi = SMD_ES, V = V_0.5_ES, mods = ~ TrophicLevel - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = dat, method = "REML")


## estimates of different Calcifier - fig 3
str_TL_ES2_fig3 <- rma.mv(yi = SMD_ES, V = V_0.5_ES, mods = ~ Calcifier - 1, 
                     random = list(~1 | StudyID, ~1 | Effect_size_ID), data = dat, method = "REML")
## y
V_0.5_ES_y <- metafor::vcalc(vi = SMDV_ES, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = filter(dat,Calcifier=="y"))

str_TL_ES2_fig3a1 <- rma.mv(yi = SMD_ES, V = V_0.5_ES_y, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="y"), method = "REML")
str_TL_ES2_fig3a2 <- rma.mv(yi = SMD_ES, V = V_0.5_ES_y, mods = ~ TrophicLevel - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="y"), method = "REML")

## n
V_0.5_ES_n <- metafor::vcalc(vi = SMDV_ES, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = filter(dat,Calcifier=="n"))

str_TL_ES2_fig3a3 <- rma.mv(yi = SMD_ES, V = V_0.5_ES_n, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="n"), method = "REML")
str_TL_ES2_fig3a4 <- rma.mv(yi = SMD_ES, V = V_0.5_ES_n, mods = ~ TrophicLevel - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = filter(dat,Calcifier=="n"), method = "REML")


## estimates of different Region2 - fig 5
str_TL_ES2_fig5 <- rma.mv(yi = SMD_ES, V = V_0.5_ES, mods = ~ Region2 - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = dat, method = "REML")
```

## Statistical issue 4

The power to detect interactive effects between multiple stressors is extremely low. Primary studies also have large Type M and Type S errors. The original author counted the percentage of different types of interaction effects (additive, antagonistic, and synergistic). Given the high sign errors of the primary studies, it is meaningless to count the percentage of different types of interaction effects.

```{r}
## lnRR
#-----------power-----------#
# meta-analysis level
## main effect 1
power.ma_Shinichi(mu=str_TL_E$beta[1],SE=str_TL_E$se[1])
## main effect 2
power.ma_Shinichi(mu=str_TL_S$beta[1],SE=str_TL_S$se[1])
## interaction
power.ma_Shinichi(mu=str_TL_ES$beta[1],SE=str_TL_ES$se[1])


#individual study level
## main effect 1
dat <- dat %>% mutate(pwr_E = power.individual_Shinichi(mu = str_TL_E$beta[1], se = sqrt(lnRRV_E)))
summary(dat$pwr_E)

## main effect 2
dat <- dat %>% mutate(pwr_S = power.individual_Shinichi(mu = str_TL_S$beta[1], se = sqrt(lnRRV_S)))
summary(dat$pwr_S)

## interaction
dat <- dat %>% mutate(pwr_ES = power.individual_Shinichi(mu = str_TL_ES$beta[1], se = sqrt(lnRRV_ES)))
summary(dat$pwr_ES)


#-----------Type S-----------#
# meta-analysis level
## main effect 1
error_S(mu=str_TL_E$beta[1],se=str_TL_E$se[1])
## main effect 2
error_S(mu=str_TL_S$beta[1],se=str_TL_S$se[1])
## interaction
error_S(mu=str_TL_ES$beta[1],se=str_TL_ES$se[1])

#individual study level
## main effect 1
S_E <- numeric(nrow(dat))
for (i in 1:nrow(dat)) {
  S_E[i] <- error_S(mu = str_TL_E$beta[1], se = sqrt(dat$lnRRV_E)[i])
}
dat$S_E <- S_E
summary(dat$S_E)

## main effect 2
S_S <- numeric(nrow(dat))
for (i in 1:nrow(dat)) {
  S_S[i] <- error_S(mu = str_TL_S$beta[1], se = sqrt(dat$lnRRV_S)[i])
}
dat$S_S <- S_S
summary(dat$S_S)

## interaction
S_ES <- numeric(nrow(dat))
for (i in 1:nrow(dat)) {
  S_ES[i] <- error_S(mu = str_TL_ES$beta[1], se = sqrt(dat$lnRRV_ES)[i])
}
dat$S_ES <- S_ES
summary(dat$S_ES)


## SMD
#-----------power-----------#
# meta-analysis level
## main effect 1
power.ma_Shinichi(mu=str_TL_E2$beta[1],SE=str_TL_E2$se[1])
## main effect 2
power.ma_Shinichi(mu=str_TL_S2$beta[1],SE=str_TL_S2$se[1])
## interaction
power.ma_Shinichi(mu=str_TL_ES2$beta[1],SE=str_TL_ES2$se[1])


#individual study level
## main effect 1
dat <- dat %>% mutate(pwr_E2 = power.individual_Shinichi(mu = str_TL_E2$beta[1], se = sqrt(SMDV_E)))
summary(dat$pwr_E2)

## main effect 2
dat <- dat %>% mutate(pwr_S2 = power.individual_Shinichi(mu = str_TL_S2$beta[1], se = sqrt(SMDV_S)))
summary(dat$pwr_S2)

## interaction
dat <- dat %>% mutate(pwr_ES2 = power.individual_Shinichi(mu = str_TL_ES2$beta[1], se = sqrt(SMDV_ES)))
summary(dat$pwr_ES2)


#-----------Type S-----------#
# meta-analysis level
## main effect 1
error_S(mu=str_TL_E2$beta[1],se=str_TL_E2$se[1])
## main effect 2
error_S(mu=str_TL_S2$beta[1],se=str_TL_S2$se[1])
## interaction
error_S(mu=str_TL_ES2$beta[1],se=str_TL_ES2$se[1])

#individual study level
## main effect 1
S_E2 <- numeric(nrow(dat))
for (i in 1:nrow(dat)) {
  S_E2[i] <- error_S(mu = str_TL_E2$beta[1], se = sqrt(dat$SMDV_E)[i])
}
dat$S_E2 <- S_E2
summary(dat$S_E2)

## main effect 2
S_S2 <- numeric(nrow(dat))
for (i in 1:nrow(dat)) {
  S_S2[i] <- error_S(mu = str_TL_S2$beta[1], se = sqrt(dat$SMDV_S)[i])
}
dat$S_S2 <- S_S2
summary(dat$S_S2)

## interaction
S_ES2 <- numeric(nrow(dat))
for (i in 1:nrow(dat)) {
  S_ES2[i] <- error_S(mu = str_TL_ES2$beta[1], se = sqrt(dat$SMDV_ES)[i])
}
dat$S_ES2 <- S_ES2
summary(dat$S_ES2)

```

## Bonus

Biologically, the effects of multiple stressors are beyond mean. Using a new set of effect size measures, we found OA could increase the among-individual variability. This has important evolutionary implication that individuals do not have a consistent response to the negative impact of OA - some individuals can buffer the negative impact from OA and can survive, while others cannot.

```{r}
# 'Focal' effect_size 
effect_sizeV <- with(dt_wide, mapply(effect_setV, 
                      CC_n = Nc,
                      CC_mean = Xc, 
                      CC_SD = Sc,
                      EC_n = Ne_OA, 
                      EC_mean = Xe_OA, 
                      EC_SD = Se_OA,
                      CS_n = Ne_OW, 
                      CS_mean = Xe_OW, 
                      CS_SD = Se_OW,
                      ES_n = Ne_interaction, 
                      ES_mean = Xe_interaction, 
                      ES_SD = Se_interaction,
                      percent = "no",
                      SIMPLIFY = FALSE
                      ))
effect_sizeV <- map_dfr(effect_sizeV, I)

# remove NA
full_info <- which(complete.cases(effect_sizeV) == TRUE)
# binding data
datV <- bind_cols(dt_wide, effect_sizeV)
datV <- datV[full_info, ]
# remove Inf and -Inf values in specified columns
datV <- datV[!is.infinite(datV$lnVRV_E) & !is.infinite(datV$lnVR_S) & !is.infinite(datV$lnVRV_S) &
             !is.infinite(datV$lnVR_ES) & !is.infinite(datV$lnVRV_ES) & !is.infinite(datV$lnCVR_E) &
             !is.infinite(datV$lnCVRV_E) & !is.infinite(datV$lnCVR_S) & !is.infinite(datV$lnCVRV_S) &
             !is.infinite(datV$lnCVR_ES) & !is.infinite(datV$lnCVRV_ES), ]


# main effect 1 - OA
## lnVR
## VCV
V_0.5_E <- metafor::vcalc(vi = lnVRV_E, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = datV)
## estimates of main effect1
str_TL_V_E <- rma.mv(yi = lnVR_E, V = V_0.5_E, 
                     random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")

p_str_TL_V_E <- orchard_plot(str_TL_V_E, group = "StudyID", xlab = "lnVR (effect size)",
                            trunk.size = 0.3, branch.size = 2, flip = FALSE)

p_str_TL_V_E
## estimates of different TrophicLevel - fig 2
rma.mv(yi = lnVR_E, V = V_0.5_E, mods = ~TrophicLevel - 1, 
       random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")
## estimates of different Calcifier - fig 3
rma.mv(yi = lnVR_E, V = V_0.5_E, mods = ~Calcifier - 1, 
       random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")
## estimates of different Region2 - fig 5
rma.mv(yi = lnVR_E, V = V_0.5_E, mods = ~Region2 - 1, 
       random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")
## lnCVR
## VCV
V_0.5_E2 <- metafor::vcalc(vi = lnCVRV_E, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = datV)
## estimates of main effect1
str_TL_V_E2 <- rma.mv(yi = lnCVR_E, V = V_0.5_E2, 
                      random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")

p_str_TL_V_E2 <- orchard_plot(str_TL_V_E2, group = "StudyID", xlab = "lnVR (effect size)",
                            trunk.size = 0.3, branch.size = 2, flip = FALSE)

p_str_TL_V_E2
## estimates of different TrophicLevel - fig 2
str_TL_V_E2a<- rma.mv(yi = lnCVR_E, V = V_0.5_E2, mods = ~ TrophicLevel - 1, 
       random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")

p_str_TL_V_E2a <- orchard_plot(str_TL_V_E2a, mod = "TrophicLevel", group = "StudyID", xlab = "lnVR (effect size)", trunk.size = 0.3, branch.size = 2, flip = FALSE)

p_str_TL_V_E2a

## estimates of different Calcifier - fig 3
str_TL_V_E2b <- rma.mv(yi = lnCVR_E, V = V_0.5_E2, mods = ~ Calcifier - 1, 
       random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")

p_str_TL_V_E2b <- orchard_plot(str_TL_V_E2b, mod = "Calcifier", group = "StudyID", xlab = "lnVR (effect size)", trunk.size = 0.3, branch.size = 2, flip = FALSE)

p_str_TL_V_E2b

## estimates of different Region2 - fig 5
str_TL_V_E2c <- rma.mv(yi = lnCVR_E, V = V_0.5_E2, mods = ~ Region2 - 1, 
       random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")

p_str_TL_V_E2c <- orchard_plot(str_TL_V_E2c, mod = "Region2", group = "StudyID", xlab = "lnVR (effect size)", trunk.size = 0.3, branch.size = 2, flip = FALSE)

p_str_TL_V_E2c


# S
# lnVR
## VCV
V_0.5_S <- metafor::vcalc(vi = lnVRV_S, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = datV)
## estimates of main effect2
str_TL_V_S <- rma.mv(yi = lnVR_S, V = V_0.5_S, 
                     random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")

p_str_TL_V_S <- orchard_plot(str_TL_V_S, group = "StudyID", xlab = "lnVR (effect size)",
                            trunk.size = 0.3, branch.size = 2, flip = FALSE)

p_str_TL_V_S

## estimates of different TrophicLevel - fig 2
rma.mv(yi = lnVR_S, V = V_0.5_S, mods = ~ TrophicLevel - 1, 
       random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")

## estimates of different Calcifier - fig 3
rma.mv(yi = lnVR_S, V = V_0.5_S, mods = ~ Calcifier - 1, 
       random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")

## estimates of different Region2 - fig 5
rma.mv(yi = lnVR_S, V = V_0.5_S, mods = ~ Region2 - 1, random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")

# lnCVR
## VCV
V_0.5_S2 <- metafor::vcalc(vi = lnCVRV_S, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = datV)
## estimates of main effect2
str_TL_V_S2 <- rma.mv(yi = lnCVR_S, V = V_0.5_S2, 
                      random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")
robust(str_TL_V_S2,cluster = StudyID, clubSandwich = T)

p_str_TL_V_S2 <- orchard_plot(str_TL_V_S2, group = "StudyID", xlab = "lnVR (effect size)",
                            trunk.size = 0.3, branch.size = 2, flip = FALSE)

p_str_TL_V_S2

## estimates of different TrophicLevel - fig 2
rma.mv(yi = lnCVR_S, V = V_0.5_S2, mods = ~ TrophicLevel - 1, 
       random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")
## estimates of different Calcifier - fig 3
rma.mv(yi = lnCVR_S, V = V_0.5_S2, mods = ~ Calcifier - 1, 
       random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")

## estimates of different Region2 - fig 5
rma.mv(yi = lnCVR_S, V = V_0.5_S2, mods = ~ Region2 - 1, 
       random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")

# ES
# lnVR
# VCV
V_0.5_ES <- metafor::vcalc(vi = lnVRV_ES, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = datV)
## estimates of interaction
str_TL_V_ES <- rma.mv(yi = lnVR_ES, V = V_0.5_ES, 
                      random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")

p_str_TL_V_ES <- orchard_plot(str_TL_V_ES, group = "StudyID", xlab = "lnVR (effect size)",
                            trunk.size = 0.3, branch.size = 2, flip = FALSE)

p_str_TL_V_ES
## estimates of different TrophicLevel - fig 2
rma.mv(yi = lnVR_ES, V = V_0.5_ES, mods = ~ TrophicLevel - 1, 
       random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")
## estimates of different Calcifier - fig 3
rma.mv(yi = lnVR_ES, V = V_0.5_ES, mods = ~ Calcifier - 1, 
       random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")

## estimates of different Region2 - fig 5
rma.mv(yi = lnVR_ES, V = V_0.5_ES, mods = ~ Region2 - 1, 
       random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")


# lnCVR
# VCV
V_0.5_ES2 <- metafor::vcalc(vi = lnCVRV_ES, cluster = share_organism, obs = Effect_size_ID, rho = 0.5, data = datV)
## estimates of their interaction
str_TL_V_ES2 <- rma.mv(yi = lnCVR_ES, V = V_0.5_ES2, 
                       random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")

p_str_TL_V_ES2 <- orchard_plot(str_TL_V_ES2, group = "StudyID", xlab = "lnVR (effect size)",
                            trunk.size = 0.3, branch.size = 2, flip = FALSE)

p_str_TL_V_ES2

## estimates of different TrophicLevel - fig 2
rma.mv(yi = lnCVR_ES, V = V_0.5_ES2, mods = ~ TrophicLevel - 1, 
       random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")
## estimates of different Calcifier - fig 3
rma.mv(yi = lnCVR_ES, V = V_0.5_ES2, mods = ~ Calcifier - 1, 
       random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")
## estimates of different Region2 - fig 5
rma.mv(yi = lnCVR_ES, V = V_0.5_ES2, mods = ~ Region2 - 1, 
       random = list(~1 | StudyID, ~1 | Effect_size_ID), data = datV, method = "REML")
```

# Figure 1

```{r}
# main effect 1 - OA
## estimates of different TrophicLevel - fig 2
str_TL_E_results <- mod_results(str_TL_E, mod = "1", group = "StudyID", data = dat)
str_TL_E_fig2_results <- mod_results(str_TL_E_fig2, mod = "TrophicLevel", group = "StudyID")

resultsE_1 <- submerge(str_TL_E_fig2_results,str_TL_E_results)
pE_1 <- orchard_plot(resultsE_1,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OA effect at the multiplicative scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Across species") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_text(size = 16),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.x = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Overall")) #+   scale_y_continuous(limits = c(-2,1.35))
  
  
## estimates of different Calcifier - fig 3
## y
str_TL_E_fig3a1_results <- mod_results(str_TL_E_fig3a1, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="y"))
str_TL_E_fig3a2_results <- mod_results(str_TL_E_fig3a2, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="y"))

resultsE_2 <- submerge(str_TL_E_fig3a2_results, str_TL_E_fig3a1_results)

pE_2 <- orchard_plot(resultsE_2,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OA effect at the multiplicative scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Calcifying species") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_text(size = 16),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.x = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Overall")) #+ scale_y_continuous(limits = c(-2,1.35))
  
## n
str_TL_E_fig3a3_results <- mod_results(str_TL_E_fig3a3, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="n"))
str_TL_E_fig3a4_results <- mod_results(str_TL_E_fig3a4, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="n"))

resultsE_3 <- submerge(str_TL_E_fig3a4_results, str_TL_E_fig3a3_results)

pE_3 <- orchard_plot(resultsE_3,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OA effect at the multiplicative scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Non-calcifying species") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_text(size = 16),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.x = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Overall")) #+ cale_y_continuous(limits = c(-2,1.35))
  
  
## estimates of different Region2 - fig 5
pE_4 <- orchard_plot(str_TL_E_fig5, mod = "Region2", group = "StudyID",
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OA effect \n (multiplicative scale, LnRR)", flip = T, angle = 50) + ggsci::scale_fill_startrek() + scale_color_manual(values = c("black", "black", "black")) + 
  labs(title = "Climate regions") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_text(size = 16),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line()) +
  scale_x_discrete(labels = c("Temperate", "Sub-tropical", "Tropical")) #+ scale_y_continuous(limits = c(-2,1.35))
  
  
# main effect 2 - OW
## estimates of different TrophicLevel - fig 2
str_TL_S_results <- mod_results(str_TL_S, mod = "1", group = "StudyID", data = dat)
str_TL_S_fig2_results <- mod_results(str_TL_S_fig2, mod = "TrophicLevel", group = "StudyID")

resultsS_1 <- submerge(str_TL_S_fig2_results,str_TL_S_results)
pS_1 <- orchard_plot(resultsS_1,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OW effect at the multiplicative scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Across species") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Overall")) #+   scale_y_continuous(limits = c(-2,1.35))
  
## estimates of different Calcifier - fig 3
## y
str_TL_S_fig3a1_results <- mod_results(str_TL_S_fig3a1, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="y"))
str_TL_S_fig3a2_results <- mod_results(str_TL_S_fig3a2, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="y"))

resultsS_2 <- submerge(str_TL_S_fig3a2_results, str_TL_S_fig3a1_results)

pS_2 <- orchard_plot(resultsS_2,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OW effect at the multiplicative scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Calcifying species") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Overall")) #+ scale_y_continuous(limits = c(-2,1.35))
  
## n
str_TL_S_fig3a3_results <- mod_results(str_TL_S_fig3a4, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="n"))
str_TL_S_fig3a4_results <- mod_results(str_TL_S_fig3a4, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="n"))

resultsS_3 <- submerge(str_TL_S_fig3a4_results, str_TL_S_fig3a3_results)

pS_3 <- orchard_plot(resultsS_3,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OW effect at the multiplicative scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Non-calcifying species") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Overall")) #+ scale_y_continuous(limits = c(-2,1.35))
 
 
## estimates of different Region2 - fig 5
pS_4 <- orchard_plot(str_TL_S_fig5, mod = "Region2", group = "StudyID",
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OW effect \n (multiplicative scale, LnRR)", flip = T, angle = 50) + ggsci::scale_fill_startrek() + scale_color_manual(values = c("black", "black", "black")) + 
  labs(title = "Climate regions") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.y = element_blank()) +
  scale_x_discrete(labels = c("Temperate", "Sub-tropical", "Tropical")) #+ scale_y_continuous(limits = c(-2,1.35))
  
# interaction
## estimates of different TrophicLevel - fig 2
str_TL_ES_results <- mod_results(str_TL_ES, mod = "1", group = "StudyID", data = dat)
str_TL_ES_fig2_results <- mod_results(str_TL_ES_fig2, mod = "TrophicLevel", group = "StudyID")

resultsES_1 <- submerge(str_TL_ES_fig2_results,str_TL_ES_results)
pES_1 <- orchard_plot(resultsES_1,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OAOW effect at the multiplicative scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Across species") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Overall")) #+   scale_y_continuous(limits = c(-2,1.35))
  
  
## estimates of different Calcifier - fig 3
## y
str_TL_ES_fig3a1_results <- mod_results(str_TL_ES_fig3a1, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="y"))
str_TL_ES_fig3a2_results <- mod_results(str_TL_ES_fig3a2, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="y"))

resultsES_2 <- submerge(str_TL_ES_fig3a2_results, str_TL_ES_fig3a1_results)

pES_2 <- orchard_plot(resultsES_2,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OAOW effect at the multiplicative scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Calcifying species") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Overall")) #+ scale_y_continuous(limits = c(-2,1.35))
  
## n
str_TL_ES_fig3a3_results <- mod_results(str_TL_ES_fig3a4, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="n"))
str_TL_ES_fig3a4_results <- mod_results(str_TL_ES_fig3a4, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="n"))

resultsES_3 <- submerge(str_TL_ES_fig3a4_results, str_TL_ES_fig3a3_results)

pES_3 <- orchard_plot(resultsES_3,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OAOW effect at the multiplicative scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Non-calcifying species") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Overall")) #+ scale_y_continuous(limits = c(-2,1.35))
  

## estimates of different Region2 - fig 5
pES_4 <- orchard_plot(str_TL_ES_fig5, mod = "Region2", group = "StudyID",
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OAOW effect \n (multiplicative scale, LnRR)", flip = T, angle = 50) + ggsci::scale_fill_startrek() + scale_color_manual(values = c("black", "black", "black")) +
  labs(title = "Climate regions") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.y = element_blank()) +
  scale_x_discrete(labels = c("Temperate", "Sub-tropical", "Tropical")) #+ scale_y_continuous(limits = c(-2,1.35))


# assembly
png(filename = here("figure", "figure1.png"), width = 14, height = 20, units = "in", type = "windows", res = 400)
  pE_1 + pS_1 + pES_1 +
  pE_2 + pS_2 + pES_2 +
  pE_3 + pS_3 + pES_3 +
  pE_4 + pS_4 + pES_4 + plot_layout(nrow = 4, ncol = 3) + plot_annotation(tag_levels = list(c('(A)', '(B)', '(C)', '(D)', '(E)', '(F)', "(G)", "(H)", "(I)", "(J)", "(K)", "(L)"))) & theme(plot.tag = element_text(size = 16, face = "bold"))
dev.off()

# alternatively
png(filename = here("figure", "figure1.png"), width = 14, height = 20, units = "in", type = "windows", res = 400)
  (pE_1 | pS_1 | pES_1) / (pE_2 | pS_2 | pES_2) / (pE_3 | pS_3 | pES_3) / (pE_4 | pS_4 | pES_4 ) + plot_annotation(tag_levels = list(c('(A)', '(B)', '(C)', '(D)', '(E)', '(F)', "(G)", "(H)", "(I)", "(J)", "(K)", "(L)"))) & theme(plot.tag = element_text(size = 16, face = "bold"))
dev.off()


```

# Figure S1

```{r}
# main effect 1 - OA
## estimates of different TrophicLevel - fig 2
str_TL_E2_results <- mod_results(str_TL_E2, mod = "1", group = "StudyID", data = dat)
str_TL_E2_fig2_results <- mod_results(str_TL_E2_fig2, mod = "TrophicLevel", group = "StudyID")

resultsE2_1 <- submerge(str_TL_E2_fig2_results,str_TL_E2_results)
pE2_1 <- orchard_plot(resultsE2_1,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OA effect at the additive scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Across species") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_text(size = 16),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.x = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Overall")) #+   scale_y_continuous(limits = c(-2,1.35))
  
  
## estimates of different Calcifier - fig 3
## y
str_TL_E2_fig3a1_results <- mod_results(str_TL_E2_fig3a1, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="y"))
str_TL_E2_fig3a2_results <- mod_results(str_TL_E2_fig3a2, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="y"))

resultsE2_2 <- submerge(str_TL_E2_fig3a2_results, str_TL_E2_fig3a1_results)

pE2_2 <- orchard_plot(resultsE2_2,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OA effect at the additive scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Calcifying species") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_text(size = 16),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.x = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Overall")) #+ scale_y_continuous(limits = c(-2,1.35))
  
## n
str_TL_E2_fig3a3_results <- mod_results(str_TL_E2_fig3a3, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="n"))
str_TL_E2_fig3a4_results <- mod_results(str_TL_E2_fig3a4, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="n"))

resultsE2_3 <- submerge(str_TL_E2_fig3a4_results, str_TL_E2_fig3a3_results)

pE2_3 <- orchard_plot(resultsE2_3,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OA effect at the additive scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Non-calcifying species") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_text(size = 16),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.x = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Overall")) #+ cale_y_continuous(limits = c(-2,1.35))
  
  
## estimates of different Region2 - fig 5
pE2_4 <- orchard_plot(str_TL_E2_fig5, mod = "Region2", group = "StudyID",
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OA effect \n (at additive scale, Hedges' g)", flip = T, angle = 50) + ggsci::scale_fill_startrek() + scale_color_manual(values = c("black", "black", "black")) + 
  labs(title = "Climate regions") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_text(size = 16),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line()) +
  scale_x_discrete(labels = c("Temperate", "Sub-tropical", "Tropical")) #+ scale_y_continuous(limits = c(-2,1.35))
  
  
# main effect 2 - OW
## estimates of different TrophicLevel - fig 2
str_TL_S2_results <- mod_results(str_TL_S2, mod = "1", group = "StudyID", data = dat)
str_TL_S2_fig2_results <- mod_results(str_TL_S2_fig2, mod = "TrophicLevel", group = "StudyID")

resultsS2_1 <- submerge(str_TL_S2_fig2_results,str_TL_S2_results)
pS2_1 <- orchard_plot(resultsS2_1,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OW effect at the additive scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Across species") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Overall")) #+   scale_y_continuous(limits = c(-2,1.35))
  
## estimates of different Calcifier - fig 3
## y
str_TL_S2_fig3a1_results <- mod_results(str_TL_S2_fig3a1, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="y"))
str_TL_S2_fig3a2_results <- mod_results(str_TL_S2_fig3a2, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="y"))

resultsS2_2 <- submerge(str_TL_S2_fig3a2_results, str_TL_S2_fig3a1_results)

pS2_2 <- orchard_plot(resultsS2_2,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OW effect at the additive scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Calcifying species") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Overall")) #+ scale_y_continuous(limits = c(-2,1.35))
  
## n
str_TL_S2_fig3a3_results <- mod_results(str_TL_S2_fig3a4, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="n"))
str_TL_S2_fig3a4_results <- mod_results(str_TL_S2_fig3a4, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="n"))

resultsS2_3 <- submerge(str_TL_S2_fig3a4_results, str_TL_S2_fig3a3_results)

pS2_3 <- orchard_plot(resultsS2_3,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OW effect at the additive scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Non-calcifying species") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Overall")) #+ scale_y_continuous(limits = c(-2,1.35))
 
 
## estimates of different Region2 - fig 5
pS2_4 <- orchard_plot(str_TL_S2_fig5, mod = "Region2", group = "StudyID",
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OW effect \n (additive scale, Hedges' g)", flip = T, angle = 50) + ggsci::scale_fill_startrek() + scale_color_manual(values = c("black", "black", "black")) + 
  labs(title = "Climate regions") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.y = element_blank()) +
  scale_x_discrete(labels = c("Temperate", "Sub-tropical", "Tropical")) #+ scale_y_continuous(limits = c(-2,1.35))
  
# interaction
## estimates of different TrophicLevel - fig 2
str_TL_ES2_results <- mod_results(str_TL_ES2, mod = "1", group = "StudyID", data = dat)
str_TL_ES2_fig2_results <- mod_results(str_TL_ES2_fig2, mod = "TrophicLevel", group = "StudyID")

resultsES2_1 <- submerge(str_TL_ES2_fig2_results,str_TL_ES2_results)
pES2_1 <- orchard_plot(resultsES2_1,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OAOW effect at the additive scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Across species") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Overall")) #+   scale_y_continuous(limits = c(-2,1.35))
  
  
## estimates of different Calcifier - fig 3
## y
str_TL_ES2_fig3a1_results <- mod_results(str_TL_ES2_fig3a1, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="y"))
str_TL_ES2_fig3a2_results <- mod_results(str_TL_ES2_fig3a2, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="y"))

resultsES2_2 <- submerge(str_TL_ES2_fig3a2_results, str_TL_ES2_fig3a1_results)

pES2_2 <- orchard_plot(resultsES2_2,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OAOW effect at the additive scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Calcifying species") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Overall")) #+ scale_y_continuous(limits = c(-2,1.35))
  
## n
str_TL_ES2_fig3a3_results <- mod_results(str_TL_ES2_fig3a4, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="n"))
str_TL_ES2_fig3a4_results <- mod_results(str_TL_ES2_fig3a4, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="n"))

resultsES2_3 <- submerge(str_TL_ES2_fig3a4_results, str_TL_ES2_fig3a3_results)

pES2_3 <- orchard_plot(resultsES2_3,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OAOW effect at the additive scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Non-calcifying species") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Overall")) #+ scale_y_continuous(limits = c(-2,1.35))
  

## estimates of different Region2 - fig 5
pES2_4 <- orchard_plot(str_TL_ES2_fig5, mod = "Region2", group = "StudyID",
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OAOW effect \n (additive scale, Hedges' g)", flip = T, angle = 50) + ggsci::scale_fill_startrek() + scale_color_manual(values = c("black", "black", "black")) +
  labs(title = "Climate regions") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.y = element_blank()) +
  scale_x_discrete(labels = c("Temperate", "Sub-tropical", "Tropical")) #+ scale_y_continuous(limits = c(-2,1.35))



png(filename = here("figure", "figureS1.png"), width = 14, height = 20, units = "in", type = "windows", res = 400)
  pE2_1 + pS2_1 + pES2_1 +
  pE2_2 + pS2_2 + pES2_2 +
  pE2_3 + pS2_3 + pES2_3 +
  pE2_4 + pS2_4 + pES2_4 + plot_layout(nrow = 4, ncol = 3) + plot_annotation(tag_levels = list(c('(A)', '(B)', '(C)', '(D)', '(E)', '(F)', "(G)", "(H)", "(I)", "(J)", "(K)", "(L)"))) & theme(plot.tag = element_text(size = 16, face = "bold"))
dev.off()



```

# Figure S2


```{r}
# make dataframe
df_error <- data.frame(pwr_LnRR = c(dat$pwr_E, dat$pwr_S, dat$pwr_ES),
                       pwr_Hedgeg = c(dat$pwr_E2, dat$pwr_S2, dat$pwr_ES2),
                       S_LnRR = c(dat$S_E, dat$S_S, dat$S_ES),
                       S_Hedgeg = c(dat$S_E2, dat$S_S2, dat$S_ES2),
                       Stressor = c(rep("OA",nrow(dat)), rep("OW",nrow(dat)), rep("OAOW",rep(nrow(dat)))))

# relevel
df_error$Stressor <- as.factor(df_error$Stressor)
df_error$Stressor <- factor(df_error$Stressor, levels = c("OA", "OW", "OAOW"))

# LnRR
p_pwr1 <- ggdensity(df_error, x = "pwr_LnRR", facet.by = "Stressor",
   add = "median", 
   rug = TRUE,
   color = "Stressor", fill = "Stressor", alpha = 1,
   palette = c("#F0B47C", "#BE7A9A", "#7985B3")
   ) +
  labs(x = "Statistical power", y = "Density") +
  theme(axis.text.x = element_text(size = 20),
        axis.text.y = element_text(size = 20),
        axis.title = element_text(size = 22),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        #legend.position = c(1, 1),
        #legend.justification = c(1, 1),
        legend.text = element_text(size = 18),
        legend.title = element_text(size = 18),
        legend.background = element_rect(fill = alpha("white", 0)),
        legend.key = element_rect(fill = alpha("white", 0)),
        strip.text = element_text(size = 20)
        )

p_S1 <- ggdensity(df_error, x = "S_LnRR", facet.by = "Stressor",
   add = "median", 
   rug = TRUE,
   color = "Stressor", fill = "Stressor", alpha = 1, 
   palette = c("#F0B47C", "#BE7A9A", "#7985B3")
   ) +
  labs(x = "Sign error", y = "Density") +
  theme(axis.text.x = element_text(size = 20),
        axis.text.y = element_text(size = 20),
        axis.title = element_text(size = 22),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.text = element_text(size = 22)) +
  guides(color = "none", fill = "none")

# Hedges'g
p_pwr2 <- ggdensity(df_error, x = "pwr_Hedgeg", facet.by = "Stressor",
   add = "median", 
   rug = TRUE,
   color = "Stressor", fill = "Stressor", alpha = 1,
   palette = c("#F0B47C", "#BE7A9A", "#7985B3")
   ) +
  labs(x = "Statistical power", y = "Density") +
  theme(axis.text.x = element_text(size = 20),
        axis.text.y = element_text(size = 20),
        axis.title = element_text(size = 22),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        #legend.position = c(1, 1),
        #legend.justification = c(1, 1),
        strip.text = element_text(size = 22),
        legend.background=element_rect(fill = alpha("white", 0)),
        legend.key=element_rect(fill = alpha("white", 0))) +
  guides(color = "none", fill = "none") + xlim(0, 0.4)

p_S2 <- ggdensity(df_error, x = "S_Hedgeg", facet.by = "Stressor",
   add = "median", 
   rug = TRUE,
   color = "Stressor", fill = "Stressor", alpha = 1, 
   palette = c("#F0B47C", "#BE7A9A", "#7985B3")
   ) +
  labs(x = "Sign error", y = "Density") +
  theme(axis.text.x = element_text(size = 20),
        axis.text.y = element_text(size = 20),
        axis.title = element_text(size = 22),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.text = element_text(size = 22)) +
  guides(color = "none", fill = "none")


# assembly
png(filename = here("figure", "figureS2.png"), width = 16, height = 20, units = "in", type = "windows", res = 400)
  p_pwr1 / p_pwr2 / p_S1 / p_S2 + plot_layout(guides = "collect") + 
  plot_annotation(tag_levels = list(c('(A) \n Multiplicative \n (LnRR)', '(B) \n Additive \n (Hedges g)', '(C) \n Multiplicative \n (LnRR)', '(D) \n Additive (Hedges g)'))) & theme(plot.tag = element_text(size = 20, face = "bold"), legend.text = element_text(size = 20), legend.title = element_text(size = 20), legend.position = 'top')
dev.off()

```


# Fig

```{r}
#--------------------------------------------------#
# LnRR
#--------------------------------------------------#
# main effect 1 - OA
## estimates of different TrophicLevel - fig 2
str_TL_E_results <- mod_results(str_TL_E, mod = "1", group = "StudyID", data = dat)
str_TL_E_fig2_results <- mod_results(str_TL_E_fig2, mod = "TrophicLevel", group = "StudyID")

resultsE_1 <- submerge(str_TL_E_fig2_results,str_TL_E_results)
pE_1 <- orchard_plot(resultsE_1,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OA effect at the multiplicative scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Across species (OA)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") + 
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_text(size = 16),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.x = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Global")) #+   scale_y_continuous(limits = c(-2,1.35))
  
  
## estimates of different Calcifier - fig 3
## y
str_TL_E_fig3a1_results <- mod_results(str_TL_E_fig3a1, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="y"))
str_TL_E_fig3a2_results <- mod_results(str_TL_E_fig3a2, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="y"))

resultsE_2 <- submerge(str_TL_E_fig3a2_results, str_TL_E_fig3a1_results)

pE_2 <- orchard_plot(resultsE_2,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OA effect at the multiplicative scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Calcifying species (OA)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") + 
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_text(size = 16),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.x = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Global")) #+ scale_y_continuous(limits = c(-2,1.35))
  
## n
str_TL_E_fig3a3_results <- mod_results(str_TL_E_fig3a3, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="n"))
str_TL_E_fig3a4_results <- mod_results(str_TL_E_fig3a4, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="n"))

resultsE_3 <- submerge(str_TL_E_fig3a4_results, str_TL_E_fig3a3_results)

pE_3 <- orchard_plot(resultsE_3,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OA effect at the multiplicative scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Non-calcifying species (OA)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") + 
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_text(size = 16),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.x = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Global")) #+ cale_y_continuous(limits = c(-2,1.35))
  
  
## estimates of different Region2 - fig 5
pE_4 <- orchard_plot(str_TL_E_fig5, mod = "Region2", group = "StudyID",
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OA effect \n (multiplicative scale, LnRR)", flip = T, angle = 50) + ggsci::scale_fill_startrek() + scale_color_manual(values = c("black", "black", "black")) + 
  labs(title = "Climate regions (OA)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") + 
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_text(size = 16),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.x = element_blank()) +
  scale_x_discrete(labels = c("Temperate", "Sub-tropical", "Tropical")) #+ scale_y_continuous(limits = c(-2,1.35))
  
  
# main effect 2 - OW
## estimates of different TrophicLevel - fig 2
str_TL_S_results <- mod_results(str_TL_S, mod = "1", group = "StudyID", data = dat)
str_TL_S_fig2_results <- mod_results(str_TL_S_fig2, mod = "TrophicLevel", group = "StudyID")

resultsS_1 <- submerge(str_TL_S_fig2_results,str_TL_S_results)
pS_1 <- orchard_plot(resultsS_1,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OW effect at the multiplicative scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Across species (OW)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") + 
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Global")) #+   scale_y_continuous(limits = c(-2,1.35))
  
## estimates of different Calcifier - fig 3
## y
str_TL_S_fig3a1_results <- mod_results(str_TL_S_fig3a1, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="y"))
str_TL_S_fig3a2_results <- mod_results(str_TL_S_fig3a2, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="y"))

resultsS_2 <- submerge(str_TL_S_fig3a2_results, str_TL_S_fig3a1_results)

pS_2 <- orchard_plot(resultsS_2,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OW effect at the multiplicative scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Calcifying species (OW)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") + 
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Global")) #+ scale_y_continuous(limits = c(-2,1.35))
  
## n
str_TL_S_fig3a3_results <- mod_results(str_TL_S_fig3a4, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="n"))
str_TL_S_fig3a4_results <- mod_results(str_TL_S_fig3a4, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="n"))

resultsS_3 <- submerge(str_TL_S_fig3a4_results, str_TL_S_fig3a3_results)

pS_3 <- orchard_plot(resultsS_3,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OW effect at the multiplicative scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Non-calcifying species (OW)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") + 
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Global")) #+ scale_y_continuous(limits = c(-2,1.35))
 
 
## estimates of different Region2 - fig 5
pS_4 <- orchard_plot(str_TL_S_fig5, mod = "Region2", group = "StudyID",
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OW effect \n (multiplicative scale, LnRR)", flip = T, angle = 50) + ggsci::scale_fill_startrek() + scale_color_manual(values = c("black", "black", "black")) + 
  labs(title = "Climate regions (OW)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") + 
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.y = element_blank(),
        axis.title.x = element_blank()) +
  scale_x_discrete(labels = c("Temperate", "Sub-tropical", "Tropical")) #+ scale_y_continuous(limits = c(-2,1.35))
  
# interaction
## estimates of different TrophicLevel - fig 2
str_TL_ES_results <- mod_results(str_TL_ES, mod = "1", group = "StudyID", data = dat)
str_TL_ES_fig2_results <- mod_results(str_TL_ES_fig2, mod = "TrophicLevel", group = "StudyID")

resultsES_1 <- submerge(str_TL_ES_fig2_results,str_TL_ES_results)
pES_1 <- orchard_plot(resultsES_1,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OAOW effect at the multiplicative scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Across species (OAOW)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") + 
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Global")) #+   scale_y_continuous(limits = c(-2,1.35))
  
  
## estimates of different Calcifier - fig 3
## y
str_TL_ES_fig3a1_results <- mod_results(str_TL_ES_fig3a1, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="y"))
str_TL_ES_fig3a2_results <- mod_results(str_TL_ES_fig3a2, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="y"))

resultsES_2 <- submerge(str_TL_ES_fig3a2_results, str_TL_ES_fig3a1_results)

pES_2 <- orchard_plot(resultsES_2,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OAOW effect at the multiplicative scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Calcifying species (OAOW)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Global")) #+ scale_y_continuous(limits = c(-2,1.35))
  
## n
str_TL_ES_fig3a3_results <- mod_results(str_TL_ES_fig3a4, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="n"))
str_TL_ES_fig3a4_results <- mod_results(str_TL_ES_fig3a4, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="n"))

resultsES_3 <- submerge(str_TL_ES_fig3a4_results, str_TL_ES_fig3a3_results)

pES_3 <- orchard_plot(resultsES_3,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OAOW effect at the multiplicative scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Non-calcifying species (OAOW)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Global")) #+ scale_y_continuous(limits = c(-2,1.35))
  

## estimates of different Region2 - fig 5
pES_4 <- orchard_plot(str_TL_ES_fig5, mod = "Region2", group = "StudyID",
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OAOW effect \n (multiplicative scale, LnRR)", flip = T, angle = 50) + ggsci::scale_fill_startrek() + scale_color_manual(values = c("black", "black", "black")) +
  labs(title = "Climate regions (OAOW)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.y = element_blank(),
        axis.title.x = element_blank()) +
  scale_x_discrete(labels = c("Temperate", "Sub-tropical", "Tropical")) #+ scale_y_continuous(limits = c(-2,1.35))


#--------------------------------------------------#
# Hedges' g
#--------------------------------------------------#

# main effect 1 - OA
## estimates of different TrophicLevel - fig 2
str_TL_E2_results <- mod_results(str_TL_E2, mod = "1", group = "StudyID", data = dat)
str_TL_E2_fig2_results <- mod_results(str_TL_E2_fig2, mod = "TrophicLevel", group = "StudyID")

resultsE2_1 <- submerge(str_TL_E2_fig2_results,str_TL_E2_results)
pE2_1 <- orchard_plot(resultsE2_1,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OA effect at the additive scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Across species (OA)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_text(size = 16),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.x = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Global")) #+   scale_y_continuous(limits = c(-2,1.35))
  
  
## estimates of different Calcifier - fig 3
## y
str_TL_E2_fig3a1_results <- mod_results(str_TL_E2_fig3a1, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="y"))
str_TL_E2_fig3a2_results <- mod_results(str_TL_E2_fig3a2, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="y"))

resultsE2_2 <- submerge(str_TL_E2_fig3a2_results, str_TL_E2_fig3a1_results)

pE2_2 <- orchard_plot(resultsE2_2,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OA effect at the additive scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Calcifying species (OA)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_text(size = 16),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.x = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Global")) #+ scale_y_continuous(limits = c(-2,1.35))
  
## n
str_TL_E2_fig3a3_results <- mod_results(str_TL_E2_fig3a3, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="n"))
str_TL_E2_fig3a4_results <- mod_results(str_TL_E2_fig3a4, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="n"))

resultsE2_3 <- submerge(str_TL_E2_fig3a4_results, str_TL_E2_fig3a3_results)

pE2_3 <- orchard_plot(resultsE2_3,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OA effect at the additive scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Non-calcifying species (OA)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_text(size = 16),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.x = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Global")) #+ cale_y_continuous(limits = c(-2,1.35))
  
  
## estimates of different Region2 - fig 5
pE2_4 <- orchard_plot(str_TL_E2_fig5, mod = "Region2", group = "StudyID",
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OA effect \n (at additive scale, Hedges' g)", flip = T, angle = 50) + ggsci::scale_fill_startrek() + scale_color_manual(values = c("black", "black", "black")) + 
  labs(title = "Climate regions (OA)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_text(size = 16),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.x = element_blank()) +
  scale_x_discrete(labels = c("Temperate", "Sub-tropical", "Tropical")) #+ scale_y_continuous(limits = c(-2,1.35))
  
  
# main effect 2 - OW
## estimates of different TrophicLevel - fig 2
str_TL_S2_results <- mod_results(str_TL_S2, mod = "1", group = "StudyID", data = dat)
str_TL_S2_fig2_results <- mod_results(str_TL_S2_fig2, mod = "TrophicLevel", group = "StudyID")

resultsS2_1 <- submerge(str_TL_S2_fig2_results,str_TL_S2_results)
pS2_1 <- orchard_plot(resultsS2_1,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OW effect at the additive scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Across species (OW)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Global")) #+   scale_y_continuous(limits = c(-2,1.35))
  
## estimates of different Calcifier - fig 3
## y
str_TL_S2_fig3a1_results <- mod_results(str_TL_S2_fig3a1, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="y"))
str_TL_S2_fig3a2_results <- mod_results(str_TL_S2_fig3a2, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="y"))

resultsS2_2 <- submerge(str_TL_S2_fig3a2_results, str_TL_S2_fig3a1_results)

pS2_2 <- orchard_plot(resultsS2_2,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OW effect at the additive scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Calcifying species (OW)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Global")) #+ scale_y_continuous(limits = c(-2,1.35))
  
## n
str_TL_S2_fig3a3_results <- mod_results(str_TL_S2_fig3a4, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="n"))
str_TL_S2_fig3a4_results <- mod_results(str_TL_S2_fig3a4, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="n"))

resultsS2_3 <- submerge(str_TL_S2_fig3a4_results, str_TL_S2_fig3a3_results)

pS2_3 <- orchard_plot(resultsS2_3,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OW effect at the additive scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Non-calcifying species (OW)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Global")) #+ scale_y_continuous(limits = c(-2,1.35))
 
 
## estimates of different Region2 - fig 5
pS2_4 <- orchard_plot(str_TL_S2_fig5, mod = "Region2", group = "StudyID",
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OW effect \n (additive scale, Hedges' g)", flip = T, angle = 50) + ggsci::scale_fill_startrek() + scale_color_manual(values = c("black", "black", "black")) + 
  labs(title = "Climate regions (OW)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.y = element_blank(),
        axis.title.x = element_blank()) +
  scale_x_discrete(labels = c("Temperate", "Sub-tropical", "Tropical")) #+ scale_y_continuous(limits = c(-2,1.35))
  
# interaction
## estimates of different TrophicLevel - fig 2
str_TL_ES2_results <- mod_results(str_TL_ES2, mod = "1", group = "StudyID", data = dat)
str_TL_ES2_fig2_results <- mod_results(str_TL_ES2_fig2, mod = "TrophicLevel", group = "StudyID")

resultsES2_1 <- submerge(str_TL_ES2_fig2_results,str_TL_ES2_results)
pES2_1 <- orchard_plot(resultsES2_1,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OAOW effect at the additive scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Across species (OAOW)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Global")) #+   scale_y_continuous(limits = c(-2,1.35))
  
  
## estimates of different Calcifier - fig 3
## y
str_TL_ES2_fig3a1_results <- mod_results(str_TL_ES2_fig3a1, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="y"))
str_TL_ES2_fig3a2_results <- mod_results(str_TL_ES2_fig3a2, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="y"))

resultsES2_2 <- submerge(str_TL_ES2_fig3a2_results, str_TL_ES2_fig3a1_results)

pES2_2 <- orchard_plot(resultsES2_2,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OAOW effect at the additive scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Calcifying species (OAOW)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Global")) #+ scale_y_continuous(limits = c(-2,1.35))
  
## n
str_TL_ES2_fig3a3_results <- mod_results(str_TL_ES2_fig3a4, mod = "1", group = "StudyID", data = filter(dat,Calcifier=="n"))
str_TL_ES2_fig3a4_results <- mod_results(str_TL_ES2_fig3a4, mod = "TrophicLevel", group = "StudyID", data = filter(dat,Calcifier=="n"))

resultsES2_3 <- submerge(str_TL_ES2_fig3a4_results, str_TL_ES2_fig3a3_results)

pES2_3 <- orchard_plot(resultsES2_3,
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OAOW effect at the additive scale", flip = T, angle = 50) + ggsci::scale_fill_jama() + scale_color_manual(values = c("black", "black", "black", "black", "black")) + 
  labs(title = "Non-calcifying species (OAOW)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        #axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title = element_blank()) +
  scale_x_discrete(labels = c("Top-predator", "Meso-predator", "Herbivore", "Primary producer", "Global")) #+ scale_y_continuous(limits = c(-2,1.35))
  

## estimates of different Region2 - fig 5
pES2_4 <- orchard_plot(str_TL_ES2_fig5, mod = "Region2", group = "StudyID",
             trunk.size = 0.3, branch.size = 2, alpha = 0.3,
             xlab = "OAOW effect \n (additive scale, Hedges' g)", flip = T, angle = 50) + ggsci::scale_fill_startrek() + scale_color_manual(values = c("black", "black", "black")) +
  labs(title = "Climate regions (OAOW)") +
  geom_hline(yintercept = 0, color = "black", linetype = "dotted") + 
  guides(size = "none") +
  theme(axis.text.x = element_text(size = 16),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 16),
        plot.title = element_text(size = 16, hjust = 0.5),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        axis.ticks.y = element_blank(),
        axis.line.x = element_line(),
        axis.title.y = element_blank(),
        axis.title.x = element_blank()) +
  scale_x_discrete(labels = c("Temperate", "Sub-tropical", "Tropical")) #+ scale_y_continuous(limits = c(-2,1.35))

# assembly
png(filename = here("figure", "fig.png"), width = 16, height = 27, units = "in", type = "windows", res = 400)
  pE_1 + pS_1 + pES_1 +
  pE2_1 + pS2_1 + pES2_1 +
    
  pE_2 + pS_2 + pES_2 +
  pE2_2 + pS2_2 + pES2_2 +
    
  pE_3 + pS_3 + pES_3 +
  pE2_3 + pS2_3 + pES2_3 +
    
  pE_4 + pS_4 + pES_4 +
  pE2_4 + pS2_4 + pES2_4 + plot_layout(nrow = 8, ncol = 3) + plot_annotation(tag_levels = list(c('(A) \n Multiplicative \n (LnRR)', '(B)', '(C)', '(D) \n Additive \n (Hedges g)', '(E)', '(F)', "(G) \n Multiplicative \n (LnRR)", "(H)", "(I)", "(J) \n Additive \n (Hedges g)", "(K)", "(L)", "(M) \n Multiplicative \n (LnRR)", "(N)", "(O)", "(P) \n Additive \n (Hedges g)", "(Q)", "(R)", "(S) \n Multiplicative \n (LnRR)", "(T)", "(U)", "(V) \n Additive \n (Hedges g)", "(W)", "(X)"))) & theme(plot.tag = element_text(size = 20, face = "bold"))
dev.off()
```

